(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3bbf1e16"],{"11c8":function(e,t,a){"use strict";a.d(t,"b",(function(){return s})),a.d(t,"g",(function(){return i})),a.d(t,"i",(function(){return n})),a.d(t,"c",(function(){return r})),a.d(t,"k",(function(){return c})),a.d(t,"a",(function(){return l})),a.d(t,"h",(function(){return u})),a.d(t,"j",(function(){return f})),a.d(t,"m",(function(){return d})),a.d(t,"d",(function(){return m})),a.d(t,"e",(function(){return p})),a.d(t,"f",(function(){return g})),a.d(t,"l",(function(){return h}));var o=a("b775");function s(e){return o["a"].get("categories",{params:e})}function i(e){return o["a"].post("categories",e)}function n(e){return o["a"].delete("categories/".concat(e))}function r(e,t){return o["a"].patch("categories/".concat(e),t)}function c(e){return o["a"].get("products",{params:e})}function l(e){return o["a"].post("products/destroy",e)}function u(e){return o["a"].post("products",e)}function f(e){return o["a"].delete("products/".concat(e))}function d(e){return o["a"].get("products/".concat(e))}function m(e,t){return o["a"].patch("products/".concat(e),t)}function p(e){return o["a"].post("products/audit",e)}function g(e){return o["a"].post("products/change_status",e)}function h(){return o["a"].get("qiniu/token")}},"1b29":function(e,t,a){"use strict";var o=a("3812"),s=a.n(o);s.a},2341:function(e,t,a){"use strict";var o=a("2de7"),s=a.n(o);s.a},"2de7":function(e,t,a){},3812:function(e,t,a){},"66b2":function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("TopTitle",{attrs:{title:e.title}}),e._v(" "),a("div",{staticClass:"displayContent"},[a("el-form",{ref:"formNode",staticClass:"form-item",attrs:{model:e.formData,rules:e.formRules,"label-width":"180px"}},[a("el-form-item",{attrs:{label:"商品类目",prop:"goodsClassifyTwo"}},[a("el-select",{attrs:{disabled:e.disabled,placeholder:"请选择"},on:{change:e.changeOneSelect},model:{value:e.formData.goodsClassifyOne,callback:function(t){e.$set(e.formData,"goodsClassifyOne",t)},expression:"formData.goodsClassifyOne"}},e._l(e.formOption.goodsClassifyOneSelectList,(function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.id}})})),1),e._v(" "),a("el-select",{attrs:{disabled:e.disabled,placeholder:"请选择"},on:{change:e.changeTwoSelect},model:{value:e.formData.goodsClassifyTwo,callback:function(t){e.$set(e.formData,"goodsClassifyTwo",t)},expression:"formData.goodsClassifyTwo"}},e._l(e.formOption.goodsClassifyTwoSelectList,(function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.id}})})),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"商品名称",prop:"name"}},[a("el-input",{attrs:{maxlength:"50",disabled:e.disabled},model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name",t)},expression:"formData.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"商品头图",prop:"images"}},[a("MyUpload",{ref:"uploads",attrs:{"file-size":1e3,"fixed-size":!1,size:{width:300,height:300},proportion:{width:2,height:1},"file-limit":5,"images-list":e.imagesFiles}})],1),e._v(" "),a("el-form-item",{attrs:{label:"商品价格（金币）",prop:"price"}},[a("el-input",{attrs:{disabled:e.disabled},model:{value:e.formData.price,callback:function(t){e.$set(e.formData,"price",t)},expression:"formData.price"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"库存",prop:"stock"}},[a("el-input",{attrs:{disabled:e.disabled},model:{value:e.formData.stock,callback:function(t){e.$set(e.formData,"stock",t)},expression:"formData.stock"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"商品详情",prop:"desc"}},[a("Tinymce",{attrs:{disabled:e.disabled},model:{value:e.formData.desc,callback:function(t){e.$set(e.formData,"desc",t)},expression:"formData.desc"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.operationButton(1)}}},[e._v("保存")]),e._v(" "),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.operationButton(2)}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.operationButton(3)}}},[e._v("预览")])],1)],1)],1)],1)},s=[],i=(a("28a5"),a("ac6a"),a("7f7f"),a("8256")),n=a("7b94"),r=a("a796"),c=a("11c8"),l={components:{Tinymce:i["a"],TopTitle:n["a"],MyUpload:r["a"]},data:function(){return{BASE_API:Object({NODE_ENV:"production",VUE_APP_BASE_API:"https://api.shjietui.com",BASE_URL:"/"}).BASE_API,formData:{goodsClassifyOne:null,goodsClassifyTwo:null,images:[],category_id:"",name:"",desc:"",price:"",stock:"",specs:[],norms:[]},selectValue:{},formOption:{goodsClassifyOneSelectList:[],goodsClassifyTwoSelectList:[]},selectData:"",formRules:{goodsClassifyTwo:[{required:!0,message:"请选择商品类目",trigger:"change"}],name:[{required:!0,message:"请填写商品名称",trigger:"change"}],images:[{required:!0,message:"请选择商品头图",trigger:"change"}],price:[{required:!0,message:"请填写商品价格",trigger:"change"}],stock:[{required:!0,message:"请填写商品库存",trigger:"change"}],desc:[{required:!0,message:"请填写商品详情",trigger:"change"}]},title:"发布/编辑商品",disabled:!1,imagesFiles:[]}},created:function(){var e=this;console.log("当前组件渲染完成:"),console.log(this.$route),Object(c["b"])().then((function(t){e.selectData=t.data,e.formOption.goodsClassifyOneSelectList=t.data})),this.$route.query.id&&this.getInfo()},methods:{getInfo:function(){var e=this;Object(c["m"])(this.$route.query.id).then((function(t){console.log(t),e.formData.name=t.data.name,e.formData.desc=t.data.desc,e.formData.price=t.data.price,e.formData.stock=t.data.stock,e.formData.goodsClassifyOne=t.data.category.parent.id,e.changeOneSelect(t.data.category.parent.id),e.formData.goodsClassifyTwo=t.data.category.id,t.data&&t.data.images&&t.data.images.length>0&&(e.imagesFiles=[],e.imagesFiles=t.data.images);for(var a=t.data.specs,o=function(t){e.formData.specs.push({name:a[t].name,values:[]}),a[t].spec_values.length>0&&a[t].spec_values.forEach((function(a){console.log(e.formData.specs),e.formData.specs[t].values.push({name:a.name})}))},s=0;s<a.length;s++)o(s);var i=t.data.norms;console.log(i),i.forEach((function(t,a){var o=t.spec_attr_names.split("/");o.forEach((function(t,o){e.selectValue["name".concat(a,"-").concat(o)]=t}))}));var n=t.data.norms,r=[];n.forEach((function(e){r.push({name:[],stock:e.stock,price:e.price})})),console.log(r),e.formData.norms=r}))},addNormsRow:function(){if(!(this.formData.specs.length>0))return this.$message.error("请完善规格信息");var e=!0;if(this.formData.specs.forEach((function(t,a){console.log(t.values.filter((function(e){return""===e.name}))),(t.values.filter((function(e){return""===e.name})).length>0||""===t.name)&&(e=!1)})),!e)return this.$message.error("请完善规格信息");this.formData.norms.push({name:[],price:"",stock:""})},addSpecsRow:function(){this.formData.specs.push({name:"",values:[{name:""}]})},addSpecsLine:function(e){this.formData.specs[e].values.push({name:""})},onSubmit:function(e){var t=this;this.formData.images=this.$refs.uploads.images,this.$refs[e].validate((function(a){if(a){console.log("提交表单:"),console.log(t.formData),console.log(t.selectValue);var o={category_id:t.formData.goodsClassifyTwo,images:JSON.stringify(t.formData.images),name:t.formData.name,desc:t.formData.desc,price:t.formData.price,stock:t.formData.stock,type:"CoinProduct"};console.log(o);var s=t.$qs.stringify(o);t.$route.query.id?Object(c["d"])(t.$route.query.id,s).then((function(a){console.log(a),t.$refs[e].resetFields(),t.$message({type:"success",message:"编辑商品成功!"}),t.$router.push("/commodity/goldCoinMall/1")})):Object(c["h"])(s).then((function(e){t.$message({type:"success",message:"创建商品成功!"}),t.$router.push("/commodity/goldCoinMall/1")})).catch((function(){}))}}))},changeOneSelect:function(e){for(var t=0;t<this.selectData.length;t++)this.selectData[t].id===e&&(this.formOption.goodsClassifyTwoSelectList=this.selectData[t].children,this.formData.goodsClassifyTwo=this.formOption.goodsClassifyTwoSelectList[0].id)},changeTwoSelect:function(e){for(var t=0;t<this.selectData.length;t++)this.selectData[t].id===e&&(this.formOption.goodsClassifyTwoSelectList=this.selectData[t].children)},resetForm:function(e,t){console.log("重置表单:"),this[t]=!1,this.$refs[e].resetFields()},operationButton:function(e){1===e&&this.onSubmit("formNode")}}},u=l,f=(a("f8a9"),a("2877")),d=Object(f["a"])(u,o,s,!1,null,null,null);t["default"]=d.exports},"7b94":function(e,t,a){"use strict";var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"topTitle"},[a("span"),a("span",{staticClass:"title"},[e._v(e._s(e.title))])])},s=[],i={props:{title:{type:String,required:!0}},data:function(){return{}}},n=i,r=(a("1b29"),a("2877")),c=Object(r["a"])(n,o,s,!1,null,"b4ebadd8",null);t["a"]=c.exports},a796:function(e,t,a){"use strict";var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e.disabled?a("div",[a("img",{staticClass:"goodsPhone",attrs:{src:e.$commonImg}})]):a("el-upload",{attrs:{data:e.QiniuData,"before-upload":e.beforeAvatarUpload,"on-remove":e.handleRemove,"on-success":e.handleAvatarSuccess,"file-list":e.formOption.goodsImageList,limit:e.fileLimit,"on-exceed":e.handleExceed,action:"https://upload-z2.qiniup.com","list-type":"picture-card"}},[a("i",{staticClass:"el-icon-plus"}),e._v(" "),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("\n      "+e._s(e.fixedSize?"建议图片尺寸"+e.size.width+"*"+e.size.height+"px ，大小不超过"+e.fileSize+"k":"建议图片比例是"+e.proportion.width+"（宽）："+e.proportion.height+"（高），大小不超过"+e.fileSize+"k")+"\n    ")])])],1)},s=[],i=(a("28a5"),a("7f7f"),a("ac6a"),a("c5f6"),a("11c8")),n=a("5f87"),r={props:{size:{type:Object,required:!0},fixedSize:{type:Boolean,required:!0},proportion:{type:Object,required:!0},fileSize:{type:Number,required:!0},fileLimit:{type:Number,required:!0},imagesList:{type:Array,required:!0}},data:function(){return{BASE_API:Object({NODE_ENV:"production",VUE_APP_BASE_API:"https://api.shjietui.com",BASE_URL:"/"}).BASE_API,images:[],formOption:{goodsClassifyOneSelectList:[],goodsClassifyTwoSelectList:[],hasModifyGoodsImage:"",goodsImageList:[]},disabled:!1,QiniuData:{key:"",token:""},uploadPicUrl:"",qiniuaddr:"http://file.shjietui.com/"}},watch:{imagesList:{handler:function(){var e=this;this.imagesList&&this.imagesList.length>0&&(this.images=[],this.formOption.goodsImageList=[],this.imagesList.forEach((function(t){var a={name:"aaa",url:t.image_path};e.formOption.goodsImageList.push(a),e.images.push(t.file_path)})))},deep:!0}},created:function(){var e=this;this.$nextTick((function(){console.log(e.imagesList),e.imagesList&&e.imagesList.length>0&&e.imagesList.forEach((function(t){var a={name:"aaa",url:t.image_path};e.formOption.goodsImageList.push(a),e.images.push(t.file_path)}))}))},mounted:function(){var e=this;Object(i["l"])().then((function(t){e.QiniuData.token=t.data.qiniu_token}))},methods:{handleAvatarSuccessSpecifications:function(e,t,a,o){console.log("文件上传成功:"),console.log(e),console.log(t),console.log(a),console.log(o),"000"===e.code?this.$set(this.formData.specificationsList[o],"thumbnailUrl",e.data):this.$message.error(e.message)},beforeAvatarUploadSpecifications:function(e){console.log("上传文件之前:");var t="image/jpeg"===e.type||"image/png"===e.type;return t||this.$message.error("上传图片只能是 JPG/PNG 格式!"),t},beforeAvatarUpload:function(e){console.log("上传文件之前:");var t="image/jpeg"===e.type||"image/png"===e.type;return t||this.$message.error("上传图片只能是 JPG/PNG 格式!"),this.QiniuData.key="".concat(Object(n["c"])()).concat(e.name),t},handleAvatarSuccess:function(e,t,a){console.log("文件上传成功:"),console.log(e),console.log(t),console.log(a),this.uploadPicUrl="".concat(e.key),console.log(this.uploadPicUrl);var o=[];console.log(a),a.forEach((function(e){"aaa"===e.name?o.push(e.url.split("//")[1].split("/")[1]):o.push("".concat(e.response.key))})),this.images=o,this.formOption.hasModifyGoodsImage=!0},handleRemove:function(e,t){console.log("文件列表移除文件:");var a=[];console.log(t),t.forEach((function(e){"aaa"===e.name?a.push(e.url.split("//")[1].split("/")[1]):a.push("".concat(e.response.key))})),this.images=a,this.formOption.hasModifyGoodsImage=!0},handleExceed:function(e,t){console.log("文件超出个数限:"),this.$message.warning("当前限制选择 ".concat(this.fileLimit," 个文件，本次选择了 ").concat(e.length," 个文件，共选择了 ").concat(e.length+t.length," 个文件"))}}},c=r,l=(a("2341"),a("2877")),u=Object(l["a"])(c,o,s,!1,null,null,null);t["a"]=u.exports},a983:function(e,t,a){},f8a9:function(e,t,a){"use strict";var o=a("a983"),s=a.n(o);s.a}}]);